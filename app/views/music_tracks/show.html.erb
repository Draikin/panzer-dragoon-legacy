<% title @music_track.name %>
<% description @music_track.description %>

<% if !@music_track.publish %>
  <p class="unpublished">Unpublished</p>
<% elsif !@music_track.category.publish %>
  <p class="unpublished">Published in Unpublished Category</p>
<% end %>

<% if policy(@music_track).new? ||
  policy(@music_track).edit? ||
  policy(@music_track).destroy?
%>
  <ul class="administration">
    <% if policy(@music_track).new? %>
      <li>
        <%= link_to 'New Music Track',
          new_music_track_path(category: @music_track.category) %>
      </li>
    <% end %>
    <% if policy(@music_track).edit? %>
      <li>
        <%= link_to 'Edit Music Track',
          edit_music_track_path(@music_track) %>
      </li>
    <% end %>
    <% if policy(@music_track).destroy? %>
      <li>
        <%= link_to 'Delete Music Track',
          @music_track,
          data: {
            confirm: 'Are you sure you want to delete this music track?'
          },
          method: :delete
        %>
      </li>
    <% end %>
  </ul>
<% end %>

<h2>Contributed By:</h2>
<ul class="thumbnail_and_name_list">
  <% @music_track.contributor_profiles.each do |contributor_profile| %>
    <li>
      <%=
        link_to(
          show_avatar(contributor_profile, :mini_thumbnail),
          contributor_profile
        )
      %>
      <h3><%= link_to contributor_profile.name, contributor_profile %></h3>
    </li>
  <% end %>
</ul>

<audio controls="true" autobuffer="true">
  <source type="audio/mp3" src="<%= @music_track.mp3_music_track.url %>" />
  <% if @music_track.ogg_music_track %>
    <source type="audio/ogg" src="<%= @music_track.ogg_music_track.url %>" />
  <% end %>
  Your browser does not support the <code>audio</code> element.
</audio>

<p><%= @music_track.description %></p>

<% unless @music_track.information.blank? %>
  <%= raw markdown_to_html @music_track.information %>
<% end %>

<p>
  <% unless @music_track.track_number == 0 %>
    Track <%= @music_track.track_number.to_s %> of
    <%= @music_track.category.music_tracks.count %>.
  <% end %>
  Download Music Track: <%= link_to "MP3", @music_track.mp3_music_track.url %>
  <% if @music_track.ogg_music_track.present? %>
     | <%= link_to "Ogg Vorbis", @music_track.ogg_music_track.url %>
  <% end %>
  <% if @music_track.flac_music_track.present? %>
     | <%= link_to "FLAC", @music_track.flac_music_track.url %>
  <% end %>
</p>

<%= render partial: 'shared/related_encyclopaedia_entries' %>

<p class="links">
  <%= link_to 'Music', music_tracks_path %> |
  <%= link_to @music_track.category.name,
    category_path(@music_track.category) %>
</p>
